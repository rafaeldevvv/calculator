(()=>{"use strict";const e=localStorage.getItem("calculator");let t;function r(e,r){t[e]=r,localStorage.setItem("calculator",JSON.stringify(t))}function n(e){return t[e]}t=e?JSON.parse(e):{history:[],theme:null};const o=["theme-blue","theme-white","theme-purple","theme-default"],s=document.documentElement;function i(e){o.forEach((e=>{s.classList.remove(e)})),s.classList.add(e),r("theme",e)}let c=n("theme");if(null===c){const e=matchMedia("(prefers-color-scheme: light)");c=e.matches?"theme-white":"theme-purple"}const l=document.querySelectorAll(".js-theme-radio");function a(e){const t=e.target;t.checked&&i(t.value)}function u(e,t){const{top:r,left:n,height:o}=t.getBoundingClientRect();e.style.left=n+10+"px",e.style.top=r+o+"px"}function d(e,t){const r=e.getAttribute("popovertarget"),n=document.getElementById(r);u(n,t),window.addEventListener("resize",(()=>{u(n,t)})),window.addEventListener("scroll",(()=>{u(n,t)})),HTMLElement.prototype.hasOwnProperty("popover")||function(e,t){e.setAttribute("aria-expanded","false"),t.classList.add("unsupported-popover"),t.setAttribute("data-visible","false"),e.addEventListener("click",(r=>{r.stopPropagation();const n="true"===e.getAttribute("aria-expanded");e.setAttribute("aria-expanded",!n),t.setAttribute("data-visible",!n)})),window.addEventListener("click",(r=>{const n="true"===e.getAttribute("aria-expanded"),{target:o}=r;!t.contains(o)&&n&&(e.setAttribute("aria-expanded",!1),t.setAttribute("data-visible",!1))}))}(e,n)}i(c),l.forEach((e=>{e.value===c?e.checked=!0:e.checked=!1,e.addEventListener("change",a)}));const p=document.createElement("visually-hidden-announcer"),h=p.attachShadow({mode:"open"}),f={clip:"rect(1px, 1px, 1px, 1px)","clip-path":"inset(50%)",height:"1px",width:"1px",margin:NaN,overflow:"hidden",padding:"0",position:"absolute"},y=document.createElement("div");y.ariaLive="assertive",y.ariaAtomic="true";const m=document.createElement("div");function g(e){m.textContent=e.toString()}function b(e,t,r,n){return t<0&&(t=e.length+t)<0&&(t=0),e.slice(0,t)+n+e.slice(t+r)}function x(e){return e.replace(/([^.\d]|^)(\d+)/g,((e,t,r)=>(t||"")+function(e,t,r,n){let o="",s=0;for(let t=e.length-1;t>=0;t--)s++,o=e[t]+o,s%3==0&&0!==t&&(o=","+o);return o}(r)))}function v(e){const{id:t,expression:r,result:n}=e;return`\n    <li class="history-entry rounded text-primary px-2 p-0.5 bg-secondary js-history-entry" data-entry-id="${t}">\n      <button \n        class="js-entry-exp history-entry__expression hover:bg-darker block text-left capitalize p-1 rounded" \n        type="button"\n      >\n      expression: ${S(x(r))}\n      </button>\n      <div class="flex">\n        <button \n          class="js-entry-res history-entry__result hover:bg-darker block text-left capitalize p-1 rounded" \n          type="button"\n        >\n        result: ${x(n.toString())}\n        </button>\n        <button \n          type="button"\n          title="Delete entry"\n          aria-label="Delete entry"\n          class="js-entry-del text-primary fs-300 js-remove-entry-btn hover:bg-darker p-1 rounded text-right uppercase"\n        >\n          <i class="fa-solid fa-trash-can"></i>\n        </button>\n      </div>\n    </li>\n  `}function E(e){return e.map(v).join("")}function S(e){return e.replace(/([-+÷x^%])/g,'<span class="operator fw-800">$&</span>').replace(/[()]/g,'<span class="paren fw-800">$&</span>')}m.ariaLive="polite",m.ariaAtomic="true",Object.assign(y.style,f),Object.assign(m.style,f),p.style.position="absolute",h.appendChild(y),h.appendChild(m),document.body.appendChild(p);let $,k,w=!1;let j=!1;function q(){if(!w||j)return;const e={duration:k,iterations:1,fill:"both"},t=document.querySelector("[role='alert']");clearTimeout($),$=void 0,j=!0,function(e,t,r){const n=e.animate([{opacity:1,top:"1.5rem"},{opacity:0,top:"-3.5rem"}],t);r&&(n.onfinish=r)}(t,e,(()=>{t.remove(),w=!1,j=!1,k=void 0}))}const L={x:(e,t)=>e*t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"÷":(e,t)=>e/t,"^":Math.pow};function A(e){let t=e;for(let r=0;r<e.length;){const n=e[r];if("("!==n)/[\d.%]/.test(n)&&(t=b(t,r,1,"*")),r++;else{const n=D(e.slice(r));t=b(t,r,n,"*".repeat(n)),r+=n}}return t}const C=/(?:[+-]?(?:(?:\d+(?:\.\d*)?|\.\d+)))/,N=/^(?:[+-]?(?:(?:\d+(?:\.\d*)?|\.\d+)))$/,I=/(\((?:[+-]?(?:(?:\d+(?:\.\d*)?|\.\d+)))\))/,M=/\*+[-+x÷^]\*+/;function T(e){return(e=A(e)).search(M)>=0}function W(e){for(let t=0;t<e.length;t++)if("("===e[t]){const r=D(e.slice(t));if(T(e.slice(t+1,t+r-1)))return{length:r,index:t}}return null}function D(e,t=!1){let r=0,n=1;if(t&&(e=e.split("").reverse().join("").replace(/([()])/g,((e,t)=>"("===t?")":"("))),!e.startsWith("("))throw new SyntaxError("Expression doesn't start with '(', so it's not possible to know the length");for(let t=1;t<e.length;t++){const o=e[t];if("("===o)r++;else{if(")"===o&&0===r){n++;break}")"===o&&r--}n++}return n}function O(e){return new RegExp(`(${C.source}|${I.source})(${e})(${C.source}|${I.source})`)}const _=[O("[\\^]"),O("[x÷]"),O("[-+]")],Y={x:!1,"+":!0,"-":!0,"÷":!1,"^":!1};function B(e){const t=A(e),r=/\*+(?<operator>.)\*+/.exec(t).groups.operator;return function(e,t,r){e=e.trim();let[n,o]=function(e,t){const r=A(e).indexOf(`*${t}*`)+1,[n,o]=function(e,t,r=!0){return r?[e.slice(0,t),e[t],e.slice(t+1)]:[e.slice(0,t),e.slice(t+1)]}(e,r,!1);return[n,o]}(e,t);n.startsWith("(")?(n=n.slice(1,n.length-1),n=V(n)):n=Number(n.slice(r?0:n.search(/[\d.]/))),o.startsWith("(")?(o=o.slice(1,o.length-1),o=V(o)):o=Number(o);const s=e.startsWith("+")||e.startsWith("-")?e[0]:"";return[n,t,o,r?void 0:s]}(e,r,Y[r])}function H(e){return function(e){for(;P.test(e);)e=e.replaceAll(P,"$1");for(;R.test(e);)e=e.replace(R,((e,t,r,n)=>`${t}-${r}${n}`));return e}(function(e){return e=(e=(e=(e=(e=e.replaceAll(")(",")x(")).replace(/(\d|\.)\(/g,"$1x(")).replace(/\)(\d|\.)/g,")x$1")).replace(/%([\d(.])/g,"%x$1")).replace(/([^\)\d.]|^)([-+])\(/g,((e,t,r)=>`${t||""}(${"+"===r?"":r}1)x(`))}(function(e){e=e.replaceAll(F,((e,t)=>`(${Number(t)/100})`)),e=(e=e.replaceAll(J,((e,t,r,n,o)=>{if(t){const e=z(t);return`${Number(e)/100}${r}`}{const e=z(o);return`${n}${Number(e)/100}`}}))).replaceAll(K,((e,t)=>""+z(t)/100));let t=0;for(;G.test(e);){const r=G.exec(e),{index:n}=r,[o,s,i,c]=r;let l=0,a=null;for(let t=n-1;t>=0;t--){const r=e[t];if(")"===r)l++;else{if("("===r&&0===l||0===t){a=t;break}"("===r&&l--}}const u=e.slice(a,n),d=z(i),p="-"===s?1-d/100:1+d/100;if(t=n+o.length,""===u||u.endsWith("("))break;e=b(e,a,u.length+o.length,`(${u})x(${p})${c}`)}return e}(e)))}const P=/\((?:\+?([\d.]+))\)/g,R=/(^|[^-+x^÷])\((?:\-([\d.]+))\)([^-+x^÷]|$)/g;function z(e){return e.startsWith("(")?Number(e.slice(1,e.length-1)):Number(e)}const F=/\(([+-]?[\d.]+)%\)/g,J=/([\d.]+|\([+-]?[\d.]+\))%([x÷^])|([x÷^])([\d.]+|\([+-]?[\d.]+\))%/g,G=/([-+])(\([+-]?[\d.]+\)|[\d.]+)%([^x^÷]|$)/,K=/^(?:(\([-+]?[\d.]+\)|[+-]?[\d.]+)%)/g;function X(e,t){for(;-1!==e.search(t);){const r=t.exec(e),n=r[0],{index:o}=r,[s,i,c,l]=B(n),a=(0,L[i])(s,c);if(e.length===n.length){e=H(e=`${a>=0&&l||""}(${a})`);continue}let u=`(${a>=0&&l||""}${a})`;const d=e.slice(0,o);""===d||/[-+x^÷]$/.test(d)||(u="+"+u),e=H(e=b(e,o,n.length,`${u}`))}return e}const Q=Number.MAX_SAFE_INTEGER.toString().length,U=[{test:new RegExp(String.raw`\d{${Q+1},}|[+-]?\d+(\.\d+)?e[+-]\d+`),message:"Number is too big: '*'",ErrorConstructor:RangeError},{test:/(?:[-+÷x^]{2,}|%{2,}|[-+÷x^]+%+)/,message:"You cannot put multiple operators together: '*'",ErrorConstructor:SyntaxError},{test:/(?:\.{2,})/,message:"Invalid expression: '*'",ErrorConstructor:SyntaxError},{test:/(?:\d+[-+÷x^])$/,message:"You forgot a number in '*'",ErrorConstructor:SyntaxError},{test:/\D\.\D/,message:"Invalid dot: '*'",ErrorConstructor:SyntaxError},{test:/^(?:\.|\.\D|\D\.)$/,message:"Invalid dot: '*'",ErrorConstructor:SyntaxError},{test:/NaN|Infinity/,message:"Invalid expression: '*'",ErrorConstructor:SyntaxError},{test:/^[-+÷x^%]$/,message:"You forgot the numbers for '*'",ErrorConstructor:SyntaxError},{test:/\(\)/,message:"Empty parenthesis are not allowed: '*'",ErrorConstructor:SyntaxError},{test:/^(?:\(|\))$/,message:"Invalid bracket: '*'",ErrorConstructor:SyntaxError},{test:/[-+÷x^]\)|\([x÷^%]/,message:"Invalid operator and bracket combination: '*'",ErrorConstructor:SyntaxError},{test:/\d*(?:\.\d*){2,}/,message:"Invalid number: '*'",ErrorConstructor:SyntaxError},{test:/^[÷x^%]/,message:"Invalid operator at the beginning of expression: '*'",ErrorConstructor:SyntaxError}];function V(e){if(function(e){U.forEach((({test:t,message:r,ErrorConstructor:n})=>{const o=t.exec(e);if(o)throw new n(r.replace("*",o[0]))}));const t=function(e){let t=0,r=!0;for(const n of e)if("("===n)t++;else if(")"===n){if(!(t>0)){r=!1;break}t--}return r&&0===t}(e);if(!t)throw new SyntaxError("You forgot to close or open some parenthesis properly")}(e),N.test(e))return Number(e);let t;for(e=H(e);t=W(e);){const{index:r,length:n}=t,o=e.slice(r+1,r+n-1);e=H(e=b(e,r,n,`(${V(o)})`))}return N.test(e)||(e=_.reduce(X,e)).startsWith("(")&&(e=e.slice(1,e.length-1)),Number(e)}const Z=document.querySelector(".js-history-popover-toggle"),ee=document.getElementById(Z.getAttribute("popovertarget")),te=document.getElementById("shortcuts-toggle"),re=document.querySelector(".js-controls");d(Z,re),d(te,re);let ne="",oe=[ne];const se=document.querySelector(".js-calculator"),ie=se.querySelectorAll("[data-symbol]"),ce=se.querySelector(".js-reset-key"),le=se.querySelector(".js-del-key"),ae=se.querySelector(".js-result-key"),ue=se.querySelector(".js-copy-button"),de=ue.querySelector(".js-icon"),pe=se.querySelector(".js-expression-container"),he=se.querySelector(".js-expression__content"),fe=document.querySelector("#history-section"),ye=document.querySelector("#history-description");let me,ge=document.querySelector("#history-menu");function be(e,t=!1){let r=x(e);he.innerHTML=S(r),pe.scrollLeft=pe.scrollWidth,t&&(matchMedia("(prefers-reduced-motion: reduce)").matches||he.animate([{opacity:0,transform:"translateY(300%)"},{opacity:1,transform:"translateY(0%)"}],{duration:500,fill:"forwards"}))}function xe(e){oe.push(ne),ne=e,g(ne?`Current expression is ${ne}`:"Expression is empty")}function ve(e,t){const r=n("history").find((t=>t.id===e)),o=("exp"===t?r.expression:r.result).toString();xe(o),be(o,!0),ee.hidePopover()}let Ee=5;function Se(){var e;const o=n("history"),{length:s}=o;if(0!==s){if(ye.textContent="Select an expression or result.",null===ge){const e=`\n    <ul\n      id="history-menu"\n      aria-labelledby="history-heading"\n      aria-describedby="history-description"\n      class="history-list flow"\n      aria-live="polite"\n      aria\n    >${E(o.slice(0,Ee))}</ul>\n  `,t=`\n    <div class="js-history-ctrls flex mt-3 gap-x-1 fs-300">\n      <button \n        type="button" \n        class="js-see-more-btn history-ctrl block rounded-full aspect-square p-1 disabled:translucent"\n        aria-label="See more"\n        ${s<=(i=Ee)?"disabled":""}\n      >\n        <i class="fa-solid fa-plus"></i>\n      </button>\n      <button \n        type="button" \n        class="js-clear-btn history-ctrl w-full block rounded-full p-1 disabled:translucent"\n      >\n        Clear history\n      </button>\n      <button \n        type="button" \n        class="js-see-less-btn history-ctrl block rounded-full aspect-square p-1 disabled:translucent"\n        aria-label="See less"\n        ${5===i?"disabled":""}\n      >\n        <i class="fa-solid fa-minus"></i>\n      </button>\n    </div>\n  `,c=function(e){return`<p id="history-count" class="fw-600 mt-3 mb-1">${e} calculation${1===e?"":"s"} stored:</p>`}(s);fe.insertAdjacentHTML("beforeend",c+e+t),function(){const e=document.querySelector(".js-clear-btn"),t=document.querySelector(".js-see-more-btn"),o=document.querySelector(".js-see-less-btn");e.addEventListener("click",(e=>{e.stopPropagation(),r("history",[]),g("History cleared!"),Se()})),t.addEventListener("click",(()=>{const e=n("history"),t=Ee+5;Ee=Math.min(e.length,t),Se()})),o.addEventListener("click",(()=>{const e=Ee-5;Ee=Math.max(e,5),Se()}))}(),ge=document.querySelector("#history-menu"),me=document.querySelector(".js-history-ctrls")}else{const e=document.querySelector("#history-count"),t=E(o.slice(0,Ee));ge.innerHTML=t,e.textContent=`${s} calculation${1===s?"":"s"} stored:`}Array.from(ge.querySelectorAll(".js-history-entry")).forEach((e=>{const o=e.querySelector(".js-entry-res"),s=e.querySelector(".js-entry-exp"),i=e.querySelector(".js-entry-del"),c=Number(e.getAttribute("data-entry-id"));s.addEventListener("click",(()=>{ve(c,"exp")})),i.addEventListener("click",(e=>{e.stopPropagation(),function(e){!function(e){r("history",t.history.filter((t=>t.id!==e)))}(e);const o=n("history");Ee=Ee>o.length?o.length<5?5:o.length:Ee,Se(),g("Entry was deleted")}(c)})),o.addEventListener("click",(()=>{ve(c,"res")}))})),function(){const e=n("history"),t=document.querySelector(".js-see-more-btn");document.querySelector(".js-see-less-btn").disabled=5===Ee,t.disabled=Ee>=e.length}()}else ye.textContent="Your previous calculations will appear here.",null==ge||ge.remove(),null==me||me.remove(),null===(e=document.querySelector("#history-count"))||void 0===e||e.remove(),me=null,ge=null;var i}function $e(){xe(ne.slice(0,ne.length-1)),be(ne)}function ke(e){xe(ne+e),be(ne)}function we(){xe(""),be(ne)}Se(),ie.forEach((e=>{const t=e.getAttribute("data-symbol");e.addEventListener("click",(()=>{(ne.includes("NaN")||ne.includes("Infinity"))&&(ne=""),xe(ne+t),be(ne),q()}))})),ce.addEventListener("click",(()=>{we(),q()})),le.addEventListener("click",(()=>{$e(),q()}));const je=new Set(["+","-","1","2","3","4","5","6","7","8","9","0","(",")","^","%","x"]);function qe(){if(0!==ne.length)try{const e=V(ne);!function(e){Number.isFinite(e.result)||(e.result=e.result.toString());const n=t.history[0],o=void 0!==n?n.id:-1;r("history",[Object.assign(Object.assign({},e),{id:o+1}),...t.history])}({expression:ne,result:e}),xe(e.toString()),Se(),be(ne,!0),g(`The result is ${e}`)}catch(e){(function(e,t){var r;const{duration:n=1e4}=t||{};clearTimeout($),null===(r=document.querySelector("[role=alert]"))||void 0===r||r.remove();const o=function(e){const t=document.createElement("div");return t.role="alert",t.textContent=e,t}(e.toString());document.body.appendChild(o),w=!0,k=Math.min(.1*n,300),function(e,t){e.animate([{opacity:0,top:"-3.5rem"},{opacity:1,top:"1.5rem"}],t)}(o,{duration:k,iterations:1,fill:"both"}),$=setTimeout((()=>{q(),$=void 0}),n-k)})(e),console.error(e)}}window.addEventListener("keydown",(e=>{const{key:t}=e;if(e.ctrlKey)"z"==t&&(ne=oe.pop()||"",be(ne));else if(je.has(t))e.preventDefault(),ke(t),q();else switch(t){case"Backspace":q(),$e();break;case"/":q(),ke("÷");break;case"=":e.preventDefault(),q(),qe();break;case"r":we(),q()}})),ae.addEventListener("click",qe),ue.addEventListener("click",(()=>{navigator.clipboard.writeText(ne).then((()=>{g("copied!"),de.classList.remove("fa-copy"),de.classList.add("fa-check"),setTimeout((()=>{de.classList.remove("fa-check"),de.classList.add("fa-copy")}),1500)}))}))})();